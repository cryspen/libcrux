/* 
  This file was generated by KaRaMeL <https://github.com/FStarLang/karamel>
  KaRaMeL invocation: /Users/bhargava/Desktop/repositories/karamel/krml -tmpdir dist/ -skip-compilation obj/FStar_Pervasives_Native.krml obj/FStar_Pervasives.krml obj/FStar_Mul.krml obj/FStar_Squash.krml obj/FStar_Classical.krml obj/FStar_Preorder.krml obj/FStar_Sealed.krml obj/FStar_Range.krml obj/FStar_Calc.krml obj/FStar_StrongExcludedMiddle.krml obj/FStar_Classical_Sugar.krml obj/FStar_List_Tot_Base.krml obj/FStar_List_Tot_Properties.krml obj/FStar_List_Tot.krml obj/FStar_Seq_Base.krml obj/FStar_Seq_Properties.krml obj/FStar_Seq.krml obj/FStar_Math_Lib.krml obj/FStar_Math_Lemmas.krml obj/FStar_BitVector.krml obj/FStar_UInt.krml obj/FStar_UInt32.krml obj/FStar_Int.krml obj/FStar_Int16.krml obj/FStar_Float.krml obj/FStar_Char.krml obj/FStar_Issue.krml obj/FStar_Monotonic_Pure.krml obj/FStar_Sealed_Inhabited.krml obj/FStar_Order.krml obj/FStar_VConfig.krml obj/FStar_Ghost.krml obj/FStar_PropositionalExtensionality.krml obj/FStar_FunctionalExtensionality.krml obj/FStar_Set.krml obj/FStar_ErasedLogic.krml obj/FStar_PredicateExtensionality.krml obj/FStar_TSet.krml obj/FStar_Monotonic_Heap.krml obj/FStar_Heap.krml obj/FStar_Map.krml obj/FStar_Monotonic_Witnessed.krml obj/FStar_Monotonic_HyperHeap.krml obj/FStar_Monotonic_HyperStack.krml obj/FStar_HyperStack.krml obj/FStar_HyperStack_ST.krml obj/FStar_Universe.krml obj/FStar_GSet.krml obj/FStar_ModifiesGen.krml obj/FStar_IndefiniteDescription.krml obj/FStar_BigOps.krml obj/LowStar_Monotonic_Buffer.krml obj/LowStar_Buffer.krml obj/LowStar_BufferOps.krml obj/Spec_Loops.krml obj/FStar_UInt64.krml obj/C_Loops.krml obj/FStar_Int64.krml obj/FStar_Int32.krml obj/FStar_Int8.krml obj/FStar_UInt16.krml obj/FStar_UInt8.krml obj/FStar_Int_Cast.krml obj/FStar_Exn.krml obj/FStar_ST.krml obj/FStar_All.krml obj/FStar_List.krml obj/FStar_BV.krml obj/FStar_UInt128.krml obj/FStar_Int_Cast_Full.krml obj/FStar_Int128.krml obj/Lib_IntTypes.krml obj/Lib_Loops.krml obj/Rust_primitives_Integers.krml obj/Rust_primitives_Arrays.krml obj/Rust_primitives.krml obj/Core_Ops_Index_IndexMut.krml obj/Core_Ops_Index.krml obj/Core_Ops.krml obj/Core_Slice_Iter.krml obj/Core_Slice.krml obj/Rust_primitives_Hax.krml obj/Core_Iter_Adapters_Step_by.krml obj/Core_Iter_Adapters_Enumerate.krml obj/Core_Iter_Traits_Iterator.krml obj/Core_Ops_Range.krml obj/Core_Iter.krml obj/Core_Num_Error.krml obj/Core_Result.krml obj/Core_Num.krml obj/Core.krml obj/Rust_primitives_Hax_Monomorphized_update_at.krml obj/Libcrux_Digest.krml obj/Libcrux_Kem_Kyber_Constants.krml obj/Libcrux_Kem_Kyber_Compress.krml obj/Core_Array.krml obj/Core_Convert.krml obj/Libcrux_Kem_Kyber_Arithmetic.krml obj/Libcrux_Kem_Kyber_Serialize.krml obj/Libcrux_Kem_MLKEM.krml -warn-error @4@5@18 -fparentheses -bundle LowStar.*,Prims -bundle Libcrux.Kem.Kyber.Serialize=Rust_primitives.*,Rust_primitives,Core.*,Core,Hax_lib.*,Hax_lib,Libcrux.*,Libcrux.Kem.Kyber.* -minimal -bundle FStar.* -add-include <stdint.h> -add-include "krml/internal/target.h" -bundle Hacl.Spec.*,Spec.*[rename=Hacl_Spec] -bundle Lib.*[rename=Hacl_Lib] -drop Lib.IntVector.Intrinsics -drop Lib.IntTypes.Intrinsics -drop Lib.IntTypes.Intrinsics_128 -fparentheses -fno-shadow -fcurly-braces -fnoreturn-else -bundle Prims,C.Failure,C,C.String,C.Loops,Spec.Loops,C.Endianness,FStar.*,LowStar.*[rename=Hacl_Krmllib] -bundle Meta.* -minimal -add-early-include <string.h> -add-early-include "krml/internal/types.h" -add-early-include "krml/lowstar_endianness.h" -dmonomorphization
  F* version: fe6dec16
  KaRaMeL version: a7be2a7c
 */

#include "Libcrux_Kem_Kyber_Serialize.h"

static int32_t v_FIELD_MODULUS = (int32_t)3329;

static uint32_t get_n_least_significant_bits(uint8_t n, uint32_t value)
{
  return value & ((1U << (uint32_t)n) - 1U);
}

static int32_t compress_q(uint8_t coefficient_bits, uint16_t fe)
{
  uint32_t compressed = (uint32_t)fe << (uint32_t)((uint32_t)coefficient_bits + 1U);
  uint32_t compressed1 = compressed + (uint32_t)v_FIELD_MODULUS;
  uint32_t compressed2 = compressed1 / (uint32_t)(v_FIELD_MODULUS << (uint32_t)(int32_t)1);
  return (int32_t)get_n_least_significant_bits(coefficient_bits, compressed2);
}

static int32_t decompress_q(uint8_t coefficient_bits, int32_t fe)
{
  uint32_t decompressed = (uint32_t)fe * (uint32_t)v_FIELD_MODULUS;
  uint32_t
  decompressed1 = (decompressed << (uint32_t)(int32_t)1) + (1U << (uint32_t)coefficient_bits);
  uint32_t decompressed2 = decompressed1 >> (uint32_t)((uint32_t)coefficient_bits + 1U);
  return (int32_t)decompressed2;
}

static uint16_t to_unsigned_representative(int32_t fe)
{
  uint32_t m = 16U;
  int32_t pow2_bits = (int32_t)1 << 16U;
  int32_t pow2_bits_minus_one = (int32_t)1 << 15U;
  int32_t
  a2 =
    ((fe + (v_FIELD_MODULUS & FStar_Int32_shift_arithmetic_right(fe, (uint32_t)(int32_t)31)))
    & (((int32_t)1 << m) - (int32_t)1))
    - pow2_bits_minus_one;
  int32_t mask = FStar_Int32_shift_arithmetic_right(a2, 31U);
  int32_t
  a3 =
    ((fe + (v_FIELD_MODULUS & FStar_Int32_shift_arithmetic_right(fe, (uint32_t)(int32_t)31)))
    & (((int32_t)1 << m) - (int32_t)1))
    - pow2_bits;
  int32_t b = a3 + (mask & pow2_bits);
  return (uint16_t)b;
}

typedef int32_t *t_KyberPolynomialRingElement;

static int32_t impl__KyberPolynomialRingElement__ZERO[256U];

uint8_t
*Libcrux_Kem_Kyber_Serialize_compress_then_serialize_10_(uint32_t v_OUT_LEN, int32_t *re)
{
  KRML_CHECK_SIZE(sizeof (uint8_t), v_OUT_LEN);
  uint8_t serialized[v_OUT_LEN];
  memset(serialized, 0U, v_OUT_LEN * sizeof (uint8_t));
  uint32_t start = 0U;
  uint32_t finish = 256U / 4U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t coefficient1 = compress_q(10U, to_unsigned_representative(re[i1 * 4U + 0U]));
    int32_t coefficient2 = compress_q(10U, to_unsigned_representative(re[i1 * 4U + 1U]));
    int32_t coefficient3 = compress_q(10U, to_unsigned_representative(re[i1 * 4U + 2U]));
    int32_t coefficient4 = compress_q(10U, to_unsigned_representative(re[i1 * 4U + 3U]));
    uint32_t m0 = 8U;
    int32_t pow2_bits0 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one0 = (int32_t)1 << 7U;
    int32_t
    a2 = ((coefficient1 & (int32_t)255) & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits_minus_one0;
    int32_t mask = FStar_Int32_shift_arithmetic_right(a2, 31U);
    int32_t a30 = ((coefficient1 & (int32_t)255) & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits0;
    int32_t b = a30 + (mask & pow2_bits0);
    serialized[5U * i1] = (uint8_t)b;
    uint32_t m1 = 8U;
    int32_t pow2_bits1 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one1 = (int32_t)1 << 7U;
    int32_t
    a20 = ((coefficient2 & (int32_t)63) & (((int32_t)1 << m1) - (int32_t)1)) - pow2_bits_minus_one1;
    int32_t mask0 = FStar_Int32_shift_arithmetic_right(a20, 31U);
    int32_t a31 = ((coefficient2 & (int32_t)63) & (((int32_t)1 << m1) - (int32_t)1)) - pow2_bits1;
    int32_t b0 = a31 + (mask0 & pow2_bits1);
    uint32_t m2 = 8U;
    int32_t pow2_bits2 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one2 = (int32_t)1 << 7U;
    int32_t
    a21 =
      ((FStar_Int32_shift_arithmetic_right(coefficient1, (uint32_t)(int32_t)8) & (int32_t)3)
      & (((int32_t)1 << m2) - (int32_t)1))
      - pow2_bits_minus_one2;
    int32_t mask1 = FStar_Int32_shift_arithmetic_right(a21, 31U);
    int32_t
    a32 =
      ((FStar_Int32_shift_arithmetic_right(coefficient1, (uint32_t)(int32_t)8) & (int32_t)3)
      & (((int32_t)1 << m2) - (int32_t)1))
      - pow2_bits2;
    int32_t b1 = a32 + (mask1 & pow2_bits2);
    serialized[5U * i1 + 1U] =
      (uint32_t)(uint8_t)b0
      << (uint32_t)(int32_t)2
      | (uint32_t)(uint8_t)b1;
    uint32_t m3 = 8U;
    int32_t pow2_bits3 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one3 = (int32_t)1 << 7U;
    int32_t
    a22 = ((coefficient3 & (int32_t)15) & (((int32_t)1 << m3) - (int32_t)1)) - pow2_bits_minus_one3;
    int32_t mask2 = FStar_Int32_shift_arithmetic_right(a22, 31U);
    int32_t a33 = ((coefficient3 & (int32_t)15) & (((int32_t)1 << m3) - (int32_t)1)) - pow2_bits3;
    int32_t b2 = a33 + (mask2 & pow2_bits3);
    uint32_t m4 = 8U;
    int32_t pow2_bits4 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one4 = (int32_t)1 << 7U;
    int32_t
    a23 =
      ((FStar_Int32_shift_arithmetic_right(coefficient2, (uint32_t)(int32_t)6) & (int32_t)15)
      & (((int32_t)1 << m4) - (int32_t)1))
      - pow2_bits_minus_one4;
    int32_t mask3 = FStar_Int32_shift_arithmetic_right(a23, 31U);
    int32_t
    a34 =
      ((FStar_Int32_shift_arithmetic_right(coefficient2, (uint32_t)(int32_t)6) & (int32_t)15)
      & (((int32_t)1 << m4) - (int32_t)1))
      - pow2_bits4;
    int32_t b3 = a34 + (mask3 & pow2_bits4);
    serialized[5U * i1 + 2U] =
      (uint32_t)(uint8_t)b2
      << (uint32_t)(int32_t)4
      | (uint32_t)(uint8_t)b3;
    uint32_t m5 = 8U;
    int32_t pow2_bits5 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one5 = (int32_t)1 << 7U;
    int32_t
    a24 = ((coefficient4 & (int32_t)3) & (((int32_t)1 << m5) - (int32_t)1)) - pow2_bits_minus_one5;
    int32_t mask4 = FStar_Int32_shift_arithmetic_right(a24, 31U);
    int32_t a35 = ((coefficient4 & (int32_t)3) & (((int32_t)1 << m5) - (int32_t)1)) - pow2_bits5;
    int32_t b4 = a35 + (mask4 & pow2_bits5);
    uint32_t m = 8U;
    int32_t pow2_bits6 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one6 = (int32_t)1 << 7U;
    int32_t
    a25 =
      ((FStar_Int32_shift_arithmetic_right(coefficient3, (uint32_t)(int32_t)4) & (int32_t)63)
      & (((int32_t)1 << m) - (int32_t)1))
      - pow2_bits_minus_one6;
    int32_t mask5 = FStar_Int32_shift_arithmetic_right(a25, 31U);
    int32_t
    a36 =
      ((FStar_Int32_shift_arithmetic_right(coefficient3, (uint32_t)(int32_t)4) & (int32_t)63)
      & (((int32_t)1 << m) - (int32_t)1))
      - pow2_bits6;
    int32_t b5 = a36 + (mask5 & pow2_bits6);
    serialized[5U * i1 + 3U] =
      (uint32_t)(uint8_t)b4
      << (uint32_t)(int32_t)6
      | (uint32_t)(uint8_t)b5;
    uint32_t m6 = 8U;
    int32_t pow2_bits = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one = (int32_t)1 << 7U;
    int32_t
    a26 =
      ((FStar_Int32_shift_arithmetic_right(coefficient4, (uint32_t)(int32_t)2) & (int32_t)255)
      & (((int32_t)1 << m6) - (int32_t)1))
      - pow2_bits_minus_one;
    int32_t mask6 = FStar_Int32_shift_arithmetic_right(a26, 31U);
    int32_t
    a3 =
      ((FStar_Int32_shift_arithmetic_right(coefficient4, (uint32_t)(int32_t)2) & (int32_t)255)
      & (((int32_t)1 << m6) - (int32_t)1))
      - pow2_bits;
    int32_t b6 = a3 + (mask6 & pow2_bits);
    serialized[5U * i1 + 4U] = (uint8_t)b6;
  }
  return serialized;
}

uint8_t
*Libcrux_Kem_Kyber_Serialize_compress_then_serialize_11_(uint32_t v_OUT_LEN, int32_t *re)
{
  KRML_CHECK_SIZE(sizeof (uint8_t), v_OUT_LEN);
  uint8_t serialized[v_OUT_LEN];
  memset(serialized, 0U, v_OUT_LEN * sizeof (uint8_t));
  uint32_t start = 0U;
  uint32_t finish = 256U / 8U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t coefficient1 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 0U]));
    int32_t coefficient2 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 1U]));
    int32_t coefficient3 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 2U]));
    int32_t coefficient4 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 3U]));
    int32_t coefficient5 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 4U]));
    int32_t coefficient6 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 5U]));
    int32_t coefficient7 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 6U]));
    int32_t coefficient8 = compress_q(11U, to_unsigned_representative(re[i1 * 8U + 7U]));
    uint32_t m0 = 8U;
    int32_t pow2_bits0 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one0 = (int32_t)1 << 7U;
    int32_t a2 = (coefficient1 & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits_minus_one0;
    int32_t mask = FStar_Int32_shift_arithmetic_right(a2, 31U);
    int32_t a30 = (coefficient1 & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits0;
    int32_t b = a30 + (mask & pow2_bits0);
    serialized[11U * i1] = (uint8_t)b;
    uint32_t m1 = 8U;
    int32_t pow2_bits1 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one1 = (int32_t)1 << 7U;
    int32_t
    a20 = ((coefficient2 & (int32_t)31) & (((int32_t)1 << m1) - (int32_t)1)) - pow2_bits_minus_one1;
    int32_t mask0 = FStar_Int32_shift_arithmetic_right(a20, 31U);
    int32_t a31 = ((coefficient2 & (int32_t)31) & (((int32_t)1 << m1) - (int32_t)1)) - pow2_bits1;
    int32_t b0 = a31 + (mask0 & pow2_bits1);
    uint32_t m2 = 8U;
    int32_t pow2_bits2 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one2 = (int32_t)1 << 7U;
    int32_t
    a21 =
      (FStar_Int32_shift_arithmetic_right(coefficient1,
        (uint32_t)(int32_t)8)
      & (((int32_t)1 << m2) - (int32_t)1))
      - pow2_bits_minus_one2;
    int32_t mask1 = FStar_Int32_shift_arithmetic_right(a21, 31U);
    int32_t
    a32 =
      (FStar_Int32_shift_arithmetic_right(coefficient1,
        (uint32_t)(int32_t)8)
      & (((int32_t)1 << m2) - (int32_t)1))
      - pow2_bits2;
    int32_t b1 = a32 + (mask1 & pow2_bits2);
    serialized[11U * i1 + 1U] =
      (uint32_t)(uint8_t)b0
      << (uint32_t)(int32_t)3
      | (uint32_t)(uint8_t)b1;
    uint32_t m3 = 8U;
    int32_t pow2_bits3 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one3 = (int32_t)1 << 7U;
    int32_t
    a22 = ((coefficient3 & (int32_t)3) & (((int32_t)1 << m3) - (int32_t)1)) - pow2_bits_minus_one3;
    int32_t mask2 = FStar_Int32_shift_arithmetic_right(a22, 31U);
    int32_t a33 = ((coefficient3 & (int32_t)3) & (((int32_t)1 << m3) - (int32_t)1)) - pow2_bits3;
    int32_t b2 = a33 + (mask2 & pow2_bits3);
    uint32_t m4 = 8U;
    int32_t pow2_bits4 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one4 = (int32_t)1 << 7U;
    int32_t
    a23 =
      (FStar_Int32_shift_arithmetic_right(coefficient2,
        (uint32_t)(int32_t)5)
      & (((int32_t)1 << m4) - (int32_t)1))
      - pow2_bits_minus_one4;
    int32_t mask3 = FStar_Int32_shift_arithmetic_right(a23, 31U);
    int32_t
    a34 =
      (FStar_Int32_shift_arithmetic_right(coefficient2,
        (uint32_t)(int32_t)5)
      & (((int32_t)1 << m4) - (int32_t)1))
      - pow2_bits4;
    int32_t b3 = a34 + (mask3 & pow2_bits4);
    serialized[11U * i1 + 2U] =
      (uint32_t)(uint8_t)b2
      << (uint32_t)(int32_t)6
      | (uint32_t)(uint8_t)b3;
    uint32_t m5 = 8U;
    int32_t pow2_bits5 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one5 = (int32_t)1 << 7U;
    int32_t
    a24 =
      ((FStar_Int32_shift_arithmetic_right(coefficient3, (uint32_t)(int32_t)2) & (int32_t)255)
      & (((int32_t)1 << m5) - (int32_t)1))
      - pow2_bits_minus_one5;
    int32_t mask4 = FStar_Int32_shift_arithmetic_right(a24, 31U);
    int32_t
    a35 =
      ((FStar_Int32_shift_arithmetic_right(coefficient3, (uint32_t)(int32_t)2) & (int32_t)255)
      & (((int32_t)1 << m5) - (int32_t)1))
      - pow2_bits5;
    int32_t b4 = a35 + (mask4 & pow2_bits5);
    serialized[11U * i1 + 3U] = (uint8_t)b4;
    uint32_t m6 = 8U;
    int32_t pow2_bits6 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one6 = (int32_t)1 << 7U;
    int32_t
    a25 =
      ((coefficient4 & (int32_t)127) & (((int32_t)1 << m6) - (int32_t)1))
      - pow2_bits_minus_one6;
    int32_t mask5 = FStar_Int32_shift_arithmetic_right(a25, 31U);
    int32_t a36 = ((coefficient4 & (int32_t)127) & (((int32_t)1 << m6) - (int32_t)1)) - pow2_bits6;
    int32_t b5 = a36 + (mask5 & pow2_bits6);
    uint32_t m7 = 8U;
    int32_t pow2_bits7 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one7 = (int32_t)1 << 7U;
    int32_t
    a26 =
      (FStar_Int32_shift_arithmetic_right(coefficient3,
        (uint32_t)(int32_t)10)
      & (((int32_t)1 << m7) - (int32_t)1))
      - pow2_bits_minus_one7;
    int32_t mask6 = FStar_Int32_shift_arithmetic_right(a26, 31U);
    int32_t
    a37 =
      (FStar_Int32_shift_arithmetic_right(coefficient3,
        (uint32_t)(int32_t)10)
      & (((int32_t)1 << m7) - (int32_t)1))
      - pow2_bits7;
    int32_t b6 = a37 + (mask6 & pow2_bits7);
    serialized[11U * i1 + 4U] =
      (uint32_t)(uint8_t)b5
      << (uint32_t)(int32_t)1
      | (uint32_t)(uint8_t)b6;
    uint32_t m8 = 8U;
    int32_t pow2_bits8 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one8 = (int32_t)1 << 7U;
    int32_t
    a27 = ((coefficient5 & (int32_t)15) & (((int32_t)1 << m8) - (int32_t)1)) - pow2_bits_minus_one8;
    int32_t mask7 = FStar_Int32_shift_arithmetic_right(a27, 31U);
    int32_t a38 = ((coefficient5 & (int32_t)15) & (((int32_t)1 << m8) - (int32_t)1)) - pow2_bits8;
    int32_t b7 = a38 + (mask7 & pow2_bits8);
    uint32_t m9 = 8U;
    int32_t pow2_bits9 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one9 = (int32_t)1 << 7U;
    int32_t
    a28 =
      (FStar_Int32_shift_arithmetic_right(coefficient4,
        (uint32_t)(int32_t)7)
      & (((int32_t)1 << m9) - (int32_t)1))
      - pow2_bits_minus_one9;
    int32_t mask8 = FStar_Int32_shift_arithmetic_right(a28, 31U);
    int32_t
    a39 =
      (FStar_Int32_shift_arithmetic_right(coefficient4,
        (uint32_t)(int32_t)7)
      & (((int32_t)1 << m9) - (int32_t)1))
      - pow2_bits9;
    int32_t b8 = a39 + (mask8 & pow2_bits9);
    serialized[11U * i1 + 5U] =
      (uint32_t)(uint8_t)b7
      << (uint32_t)(int32_t)4
      | (uint32_t)(uint8_t)b8;
    uint32_t m10 = 8U;
    int32_t pow2_bits10 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one10 = (int32_t)1 << 7U;
    int32_t
    a29 =
      ((coefficient6 & (int32_t)1) & (((int32_t)1 << m10) - (int32_t)1))
      - pow2_bits_minus_one10;
    int32_t mask9 = FStar_Int32_shift_arithmetic_right(a29, 31U);
    int32_t
    a310 = ((coefficient6 & (int32_t)1) & (((int32_t)1 << m10) - (int32_t)1)) - pow2_bits10;
    int32_t b9 = a310 + (mask9 & pow2_bits10);
    uint32_t m11 = 8U;
    int32_t pow2_bits11 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one11 = (int32_t)1 << 7U;
    int32_t
    a210 =
      (FStar_Int32_shift_arithmetic_right(coefficient5,
        (uint32_t)(int32_t)4)
      & (((int32_t)1 << m11) - (int32_t)1))
      - pow2_bits_minus_one11;
    int32_t mask10 = FStar_Int32_shift_arithmetic_right(a210, 31U);
    int32_t
    a311 =
      (FStar_Int32_shift_arithmetic_right(coefficient5,
        (uint32_t)(int32_t)4)
      & (((int32_t)1 << m11) - (int32_t)1))
      - pow2_bits11;
    int32_t b10 = a311 + (mask10 & pow2_bits11);
    serialized[11U * i1 + 6U] =
      (uint32_t)(uint8_t)b9
      << (uint32_t)(int32_t)7
      | (uint32_t)(uint8_t)b10;
    uint32_t m12 = 8U;
    int32_t pow2_bits12 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one12 = (int32_t)1 << 7U;
    int32_t
    a211 =
      ((FStar_Int32_shift_arithmetic_right(coefficient6, (uint32_t)(int32_t)1) & (int32_t)255)
      & (((int32_t)1 << m12) - (int32_t)1))
      - pow2_bits_minus_one12;
    int32_t mask11 = FStar_Int32_shift_arithmetic_right(a211, 31U);
    int32_t
    a312 =
      ((FStar_Int32_shift_arithmetic_right(coefficient6, (uint32_t)(int32_t)1) & (int32_t)255)
      & (((int32_t)1 << m12) - (int32_t)1))
      - pow2_bits12;
    int32_t b11 = a312 + (mask11 & pow2_bits12);
    serialized[11U * i1 + 7U] = (uint8_t)b11;
    uint32_t m13 = 8U;
    int32_t pow2_bits13 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one13 = (int32_t)1 << 7U;
    int32_t
    a212 =
      ((coefficient7 & (int32_t)63) & (((int32_t)1 << m13) - (int32_t)1))
      - pow2_bits_minus_one13;
    int32_t mask12 = FStar_Int32_shift_arithmetic_right(a212, 31U);
    int32_t
    a313 = ((coefficient7 & (int32_t)63) & (((int32_t)1 << m13) - (int32_t)1)) - pow2_bits13;
    int32_t b12 = a313 + (mask12 & pow2_bits13);
    uint32_t m14 = 8U;
    int32_t pow2_bits14 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one14 = (int32_t)1 << 7U;
    int32_t
    a213 =
      (FStar_Int32_shift_arithmetic_right(coefficient6,
        (uint32_t)(int32_t)9)
      & (((int32_t)1 << m14) - (int32_t)1))
      - pow2_bits_minus_one14;
    int32_t mask13 = FStar_Int32_shift_arithmetic_right(a213, 31U);
    int32_t
    a314 =
      (FStar_Int32_shift_arithmetic_right(coefficient6,
        (uint32_t)(int32_t)9)
      & (((int32_t)1 << m14) - (int32_t)1))
      - pow2_bits14;
    int32_t b13 = a314 + (mask13 & pow2_bits14);
    serialized[11U * i1 + 8U] =
      (uint32_t)(uint8_t)b12
      << (uint32_t)(int32_t)2
      | (uint32_t)(uint8_t)b13;
    uint32_t m15 = 8U;
    int32_t pow2_bits15 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one15 = (int32_t)1 << 7U;
    int32_t
    a214 =
      ((coefficient8 & (int32_t)7) & (((int32_t)1 << m15) - (int32_t)1))
      - pow2_bits_minus_one15;
    int32_t mask14 = FStar_Int32_shift_arithmetic_right(a214, 31U);
    int32_t
    a315 = ((coefficient8 & (int32_t)7) & (((int32_t)1 << m15) - (int32_t)1)) - pow2_bits15;
    int32_t b14 = a315 + (mask14 & pow2_bits15);
    uint32_t m = 8U;
    int32_t pow2_bits16 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one16 = (int32_t)1 << 7U;
    int32_t
    a215 =
      (FStar_Int32_shift_arithmetic_right(coefficient7,
        (uint32_t)(int32_t)6)
      & (((int32_t)1 << m) - (int32_t)1))
      - pow2_bits_minus_one16;
    int32_t mask15 = FStar_Int32_shift_arithmetic_right(a215, 31U);
    int32_t
    a316 =
      (FStar_Int32_shift_arithmetic_right(coefficient7,
        (uint32_t)(int32_t)6)
      & (((int32_t)1 << m) - (int32_t)1))
      - pow2_bits16;
    int32_t b15 = a316 + (mask15 & pow2_bits16);
    serialized[11U * i1 + 9U] =
      (uint32_t)(uint8_t)b14
      << (uint32_t)(int32_t)5
      | (uint32_t)(uint8_t)b15;
    uint32_t m16 = 8U;
    int32_t pow2_bits = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one = (int32_t)1 << 7U;
    int32_t
    a216 =
      (FStar_Int32_shift_arithmetic_right(coefficient8,
        (uint32_t)(int32_t)3)
      & (((int32_t)1 << m16) - (int32_t)1))
      - pow2_bits_minus_one;
    int32_t mask16 = FStar_Int32_shift_arithmetic_right(a216, 31U);
    int32_t
    a3 =
      (FStar_Int32_shift_arithmetic_right(coefficient8,
        (uint32_t)(int32_t)3)
      & (((int32_t)1 << m16) - (int32_t)1))
      - pow2_bits;
    int32_t b16 = a3 + (mask16 & pow2_bits);
    serialized[11U * i1 + 10U] = (uint8_t)b16;
  }
  return serialized;
}

uint8_t
*Libcrux_Kem_Kyber_Serialize_compress_then_serialize_4_(uint32_t v_OUT_LEN, int32_t *re)
{
  KRML_CHECK_SIZE(sizeof (uint8_t), v_OUT_LEN);
  uint8_t serialized[v_OUT_LEN];
  memset(serialized, 0U, v_OUT_LEN * sizeof (uint8_t));
  uint32_t start = 0U;
  uint32_t finish = 256U / 2U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t uu____0 = compress_q(4U, to_unsigned_representative(re[i1 * 2U + 0U]));
    uint32_t m0 = 8U;
    int32_t pow2_bits0 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one0 = (int32_t)1 << 7U;
    int32_t a2 = (uu____0 & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits_minus_one0;
    int32_t mask = FStar_Int32_shift_arithmetic_right(a2, 31U);
    int32_t a30 = (uu____0 & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits0;
    int32_t b = a30 + (mask & pow2_bits0);
    uint8_t coefficient1 = (uint8_t)b;
    int32_t uu____1 = compress_q(4U, to_unsigned_representative(re[i1 * 2U + 1U]));
    uint32_t m = 8U;
    int32_t pow2_bits = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one = (int32_t)1 << 7U;
    int32_t a20 = (uu____1 & (((int32_t)1 << m) - (int32_t)1)) - pow2_bits_minus_one;
    int32_t mask0 = FStar_Int32_shift_arithmetic_right(a20, 31U);
    int32_t a3 = (uu____1 & (((int32_t)1 << m) - (int32_t)1)) - pow2_bits;
    int32_t b0 = a3 + (mask0 & pow2_bits);
    uint8_t coefficient2 = (uint8_t)b0;
    serialized[i1] = (uint32_t)coefficient2 << (uint32_t)(int32_t)4 | (uint32_t)coefficient1;
  }
  return serialized;
}

uint8_t
*Libcrux_Kem_Kyber_Serialize_compress_then_serialize_5_(uint32_t v_OUT_LEN, int32_t *re)
{
  KRML_CHECK_SIZE(sizeof (uint8_t), v_OUT_LEN);
  uint8_t serialized[v_OUT_LEN];
  memset(serialized, 0U, v_OUT_LEN * sizeof (uint8_t));
  uint32_t start = 0U;
  uint32_t finish = 256U / 8U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t uu____0 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 0U]));
    uint32_t m0 = 8U;
    int32_t pow2_bits0 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one0 = (int32_t)1 << 7U;
    int32_t a2 = (uu____0 & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits_minus_one0;
    int32_t mask = FStar_Int32_shift_arithmetic_right(a2, 31U);
    int32_t a30 = (uu____0 & (((int32_t)1 << m0) - (int32_t)1)) - pow2_bits0;
    int32_t b = a30 + (mask & pow2_bits0);
    uint8_t coefficient1 = (uint8_t)b;
    int32_t uu____1 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 1U]));
    uint32_t m1 = 8U;
    int32_t pow2_bits1 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one1 = (int32_t)1 << 7U;
    int32_t a20 = (uu____1 & (((int32_t)1 << m1) - (int32_t)1)) - pow2_bits_minus_one1;
    int32_t mask0 = FStar_Int32_shift_arithmetic_right(a20, 31U);
    int32_t a31 = (uu____1 & (((int32_t)1 << m1) - (int32_t)1)) - pow2_bits1;
    int32_t b0 = a31 + (mask0 & pow2_bits1);
    uint8_t coefficient2 = (uint8_t)b0;
    int32_t uu____2 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 2U]));
    uint32_t m2 = 8U;
    int32_t pow2_bits2 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one2 = (int32_t)1 << 7U;
    int32_t a21 = (uu____2 & (((int32_t)1 << m2) - (int32_t)1)) - pow2_bits_minus_one2;
    int32_t mask1 = FStar_Int32_shift_arithmetic_right(a21, 31U);
    int32_t a32 = (uu____2 & (((int32_t)1 << m2) - (int32_t)1)) - pow2_bits2;
    int32_t b1 = a32 + (mask1 & pow2_bits2);
    uint8_t coefficient3 = (uint8_t)b1;
    int32_t uu____3 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 3U]));
    uint32_t m3 = 8U;
    int32_t pow2_bits3 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one3 = (int32_t)1 << 7U;
    int32_t a22 = (uu____3 & (((int32_t)1 << m3) - (int32_t)1)) - pow2_bits_minus_one3;
    int32_t mask2 = FStar_Int32_shift_arithmetic_right(a22, 31U);
    int32_t a33 = (uu____3 & (((int32_t)1 << m3) - (int32_t)1)) - pow2_bits3;
    int32_t b2 = a33 + (mask2 & pow2_bits3);
    uint8_t coefficient4 = (uint8_t)b2;
    int32_t uu____4 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 4U]));
    uint32_t m4 = 8U;
    int32_t pow2_bits4 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one4 = (int32_t)1 << 7U;
    int32_t a23 = (uu____4 & (((int32_t)1 << m4) - (int32_t)1)) - pow2_bits_minus_one4;
    int32_t mask3 = FStar_Int32_shift_arithmetic_right(a23, 31U);
    int32_t a34 = (uu____4 & (((int32_t)1 << m4) - (int32_t)1)) - pow2_bits4;
    int32_t b3 = a34 + (mask3 & pow2_bits4);
    uint8_t coefficient5 = (uint8_t)b3;
    int32_t uu____5 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 5U]));
    uint32_t m5 = 8U;
    int32_t pow2_bits5 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one5 = (int32_t)1 << 7U;
    int32_t a24 = (uu____5 & (((int32_t)1 << m5) - (int32_t)1)) - pow2_bits_minus_one5;
    int32_t mask4 = FStar_Int32_shift_arithmetic_right(a24, 31U);
    int32_t a35 = (uu____5 & (((int32_t)1 << m5) - (int32_t)1)) - pow2_bits5;
    int32_t b4 = a35 + (mask4 & pow2_bits5);
    uint8_t coefficient6 = (uint8_t)b4;
    int32_t uu____6 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 6U]));
    uint32_t m6 = 8U;
    int32_t pow2_bits6 = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one6 = (int32_t)1 << 7U;
    int32_t a25 = (uu____6 & (((int32_t)1 << m6) - (int32_t)1)) - pow2_bits_minus_one6;
    int32_t mask5 = FStar_Int32_shift_arithmetic_right(a25, 31U);
    int32_t a36 = (uu____6 & (((int32_t)1 << m6) - (int32_t)1)) - pow2_bits6;
    int32_t b5 = a36 + (mask5 & pow2_bits6);
    uint8_t coefficient7 = (uint8_t)b5;
    int32_t uu____7 = compress_q(5U, to_unsigned_representative(re[i1 * 8U + 7U]));
    uint32_t m = 8U;
    int32_t pow2_bits = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one = (int32_t)1 << 7U;
    int32_t a26 = (uu____7 & (((int32_t)1 << m) - (int32_t)1)) - pow2_bits_minus_one;
    int32_t mask6 = FStar_Int32_shift_arithmetic_right(a26, 31U);
    int32_t a3 = (uu____7 & (((int32_t)1 << m) - (int32_t)1)) - pow2_bits;
    int32_t b6 = a3 + (mask6 & pow2_bits);
    uint8_t coefficient8 = (uint8_t)b6;
    serialized[5U * i1] =
      ((uint32_t)coefficient2 & 7U)
      << (uint32_t)(int32_t)5
      | (uint32_t)coefficient1;
    serialized[5U * i1 + 1U] =
      (((uint32_t)coefficient4 & 1U)
      << (uint32_t)(int32_t)7
      | (uint32_t)coefficient3 << (uint32_t)(int32_t)2)
      | (uint32_t)coefficient2 >> (uint32_t)(int32_t)3;
    serialized[5U * i1 + 2U] =
      ((uint32_t)coefficient5 & 15U)
      << (uint32_t)(int32_t)4
      | (uint32_t)coefficient4 >> (uint32_t)(int32_t)1;
    serialized[5U * i1 + 3U] =
      (((uint32_t)coefficient7 & 3U)
      << (uint32_t)(int32_t)6
      | (uint32_t)coefficient6 << (uint32_t)(int32_t)1)
      | (uint32_t)coefficient5 >> (uint32_t)(int32_t)4;
    serialized[5U * i1 + 4U] =
      (uint32_t)coefficient8
      << (uint32_t)(int32_t)3
      | (uint32_t)coefficient7 >> (uint32_t)(int32_t)2;
  }
  return serialized;
}

uint8_t *Libcrux_Kem_Kyber_Serialize_compress_then_serialize_message(int32_t *re)
{
  uint8_t serialized[32U] = { 0U };
  uint32_t start = 0U;
  uint32_t finish = 256U / 8U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t index = i;
    uint32_t i1 = index / 8U;
    uint32_t j = index % 8U;
    int32_t coefficient = re[index];
    uint16_t coefficient1 = to_unsigned_representative(coefficient);
    int32_t coefficient_compressed = compress_q(1U, coefficient1);
    uint8_t uu____0 = serialized[i1];
    uint32_t m = 8U;
    int32_t pow2_bits = (int32_t)1 << 8U;
    int32_t pow2_bits_minus_one = (int32_t)1 << 7U;
    int32_t a2 = (coefficient_compressed & (((int32_t)1 << m) - (int32_t)1)) - pow2_bits_minus_one;
    int32_t mask = FStar_Int32_shift_arithmetic_right(a2, 31U);
    int32_t a3 = (coefficient_compressed & (((int32_t)1 << m) - (int32_t)1)) - pow2_bits;
    int32_t b = a3 + (mask & pow2_bits);
    serialized[i1] = (uint32_t)uu____0 | (uint32_t)(uint8_t)b << j;
  }
  return serialized;
}

uint8_t
*Libcrux_Kem_Kyber_Serialize_compress_then_serialize_ring_element_u(
  uint32_t v_COMPRESSION_FACTOR,
  uint32_t v_OUT_LEN,
  int32_t *re
)
{
  switch (v_COMPRESSION_FACTOR)
  {
    case 10U:
      {
        return Libcrux_Kem_Kyber_Serialize_compress_then_serialize_10_(v_OUT_LEN, re);
      }
    case 11U:
      {
        return Libcrux_Kem_Kyber_Serialize_compress_then_serialize_11_(v_OUT_LEN, re);
      }
    default:
      {
        KRML_HOST_EPRINTF("KaRaMeL incomplete match at %s:%d\n", __FILE__, __LINE__);
        KRML_HOST_EXIT(253U);
      }
  }
}

uint8_t
*Libcrux_Kem_Kyber_Serialize_compress_then_serialize_ring_element_v(
  uint32_t v_COMPRESSION_FACTOR,
  uint32_t v_OUT_LEN,
  int32_t *re
)
{
  switch (v_COMPRESSION_FACTOR)
  {
    case 4U:
      {
        return Libcrux_Kem_Kyber_Serialize_compress_then_serialize_4_(v_OUT_LEN, re);
      }
    case 5U:
      {
        return Libcrux_Kem_Kyber_Serialize_compress_then_serialize_5_(v_OUT_LEN, re);
      }
    default:
      {
        KRML_HOST_EPRINTF("KaRaMeL incomplete match at %s:%d\n", __FILE__, __LINE__);
        KRML_HOST_EXIT(253U);
      }
  }
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_10_(
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  int32_t *re = impl__KyberPolynomialRingElement__ZERO;
  uint32_t start = 0U;
  uint32_t finish = serialized.len / 5U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t byte1 = (int32_t)serialized.buffer[i1 * 5U + 0U];
    int32_t byte2 = (int32_t)serialized.buffer[i1 * 5U + 1U];
    int32_t byte3 = (int32_t)serialized.buffer[i1 * 5U + 2U];
    int32_t byte4 = (int32_t)serialized.buffer[i1 * 5U + 3U];
    int32_t byte5 = (int32_t)serialized.buffer[i1 * 5U + 4U];
    int32_t coefficient1 = (byte2 & (int32_t)3) << (uint32_t)(int32_t)8 | (byte1 & (int32_t)255);
    re[4U * i1] = decompress_q(10U, coefficient1);
    int32_t
    coefficient2 =
      (byte3 & (int32_t)15)
      << (uint32_t)(int32_t)6
      | FStar_Int32_shift_arithmetic_right(byte2, (uint32_t)(int32_t)2);
    re[4U * i1 + 1U] = decompress_q(10U, coefficient2);
    int32_t
    coefficient3 =
      (byte4 & (int32_t)63)
      << (uint32_t)(int32_t)4
      | FStar_Int32_shift_arithmetic_right(byte3, (uint32_t)(int32_t)4);
    re[4U * i1 + 2U] = decompress_q(10U, coefficient3);
    int32_t
    coefficient4 =
      byte5
      << (uint32_t)(int32_t)2
      | FStar_Int32_shift_arithmetic_right(byte4, (uint32_t)(int32_t)6);
    re[4U * i1 + 3U] = decompress_q(10U, coefficient4);
  }
  return re;
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_11_(
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  int32_t *re = impl__KyberPolynomialRingElement__ZERO;
  uint32_t start = 0U;
  uint32_t finish = serialized.len / 11U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t byte1 = (int32_t)serialized.buffer[i1 * 11U + 0U];
    int32_t byte2 = (int32_t)serialized.buffer[i1 * 11U + 1U];
    int32_t byte3 = (int32_t)serialized.buffer[i1 * 11U + 2U];
    int32_t byte4 = (int32_t)serialized.buffer[i1 * 11U + 3U];
    int32_t byte5 = (int32_t)serialized.buffer[i1 * 11U + 4U];
    int32_t byte6 = (int32_t)serialized.buffer[i1 * 11U + 5U];
    int32_t byte7 = (int32_t)serialized.buffer[i1 * 11U + 6U];
    int32_t byte8 = (int32_t)serialized.buffer[i1 * 11U + 7U];
    int32_t byte9 = (int32_t)serialized.buffer[i1 * 11U + 8U];
    int32_t byte10 = (int32_t)serialized.buffer[i1 * 11U + 9U];
    int32_t byte11 = (int32_t)serialized.buffer[i1 * 11U + 10U];
    int32_t coefficient1 = (byte2 & (int32_t)7) << (uint32_t)(int32_t)8 | byte1;
    re[8U * i1] = decompress_q(11U, coefficient1);
    int32_t
    coefficient2 =
      (byte3 & (int32_t)63)
      << (uint32_t)(int32_t)5
      | FStar_Int32_shift_arithmetic_right(byte2, (uint32_t)(int32_t)3);
    re[8U * i1 + 1U] = decompress_q(11U, coefficient2);
    int32_t
    coefficient3 =
      ((byte5 & (int32_t)1) << (uint32_t)(int32_t)10 | byte4 << (uint32_t)(int32_t)2)
      | FStar_Int32_shift_arithmetic_right(byte3, (uint32_t)(int32_t)6);
    re[8U * i1 + 2U] = decompress_q(11U, coefficient3);
    int32_t
    coefficient4 =
      (byte6 & (int32_t)15)
      << (uint32_t)(int32_t)7
      | FStar_Int32_shift_arithmetic_right(byte5, (uint32_t)(int32_t)1);
    re[8U * i1 + 3U] = decompress_q(11U, coefficient4);
    int32_t
    coefficient5 =
      (byte7 & (int32_t)127)
      << (uint32_t)(int32_t)4
      | FStar_Int32_shift_arithmetic_right(byte6, (uint32_t)(int32_t)4);
    re[8U * i1 + 4U] = decompress_q(11U, coefficient5);
    int32_t
    coefficient6 =
      ((byte9 & (int32_t)3) << (uint32_t)(int32_t)9 | byte8 << (uint32_t)(int32_t)1)
      | FStar_Int32_shift_arithmetic_right(byte7, (uint32_t)(int32_t)7);
    re[8U * i1 + 5U] = decompress_q(11U, coefficient6);
    int32_t
    coefficient7 =
      (byte10 & (int32_t)31)
      << (uint32_t)(int32_t)6
      | FStar_Int32_shift_arithmetic_right(byte9, (uint32_t)(int32_t)2);
    re[8U * i1 + 6U] = decompress_q(11U, coefficient7);
    int32_t
    coefficient8 =
      byte11
      << (uint32_t)(int32_t)3
      | FStar_Int32_shift_arithmetic_right(byte10, (uint32_t)(int32_t)5);
    re[8U * i1 + 7U] = decompress_q(11U, coefficient8);
  }
  return re;
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_4_(
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  int32_t *re = impl__KyberPolynomialRingElement__ZERO;
  uint32_t start = 0U;
  uint32_t finish = serialized.len;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    uint8_t byte = serialized.buffer[i1];
    int32_t coefficient1 = (int32_t)((uint32_t)byte & 15U);
    re[2U * i1] = decompress_q(4U, coefficient1);
    int32_t coefficient2 = (int32_t)((uint32_t)byte >> (uint32_t)(int32_t)4 & 15U);
    re[2U * i1 + 1U] = decompress_q(4U, coefficient2);
  }
  return re;
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_5_(
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  int32_t *re = impl__KyberPolynomialRingElement__ZERO;
  uint32_t start = 0U;
  uint32_t finish = serialized.len / 5U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t byte1 = (int32_t)serialized.buffer[i1 * 5U + 0U];
    int32_t byte2 = (int32_t)serialized.buffer[i1 * 5U + 1U];
    int32_t byte3 = (int32_t)serialized.buffer[i1 * 5U + 2U];
    int32_t byte4 = (int32_t)serialized.buffer[i1 * 5U + 3U];
    int32_t byte5 = (int32_t)serialized.buffer[i1 * 5U + 4U];
    int32_t coefficient1 = byte1 & (int32_t)31;
    re[8U * i1] = decompress_q(5U, coefficient1);
    int32_t
    coefficient2 =
      (byte2 & (int32_t)3)
      << (uint32_t)(int32_t)3
      | FStar_Int32_shift_arithmetic_right(byte1, (uint32_t)(int32_t)5);
    re[8U * i1 + 1U] = decompress_q(5U, coefficient2);
    int32_t
    coefficient3 = FStar_Int32_shift_arithmetic_right(byte2, (uint32_t)(int32_t)2) & (int32_t)31;
    re[8U * i1 + 2U] = decompress_q(5U, coefficient3);
    int32_t
    coefficient4 =
      (byte3 & (int32_t)15)
      << (uint32_t)(int32_t)1
      | FStar_Int32_shift_arithmetic_right(byte2, (uint32_t)(int32_t)7);
    re[8U * i1 + 3U] = decompress_q(5U, coefficient4);
    int32_t
    coefficient5 =
      (byte4 & (int32_t)1)
      << (uint32_t)(int32_t)4
      | FStar_Int32_shift_arithmetic_right(byte3, (uint32_t)(int32_t)4);
    re[8U * i1 + 4U] = decompress_q(5U, coefficient5);
    int32_t
    coefficient6 = FStar_Int32_shift_arithmetic_right(byte4, (uint32_t)(int32_t)1) & (int32_t)31;
    re[8U * i1 + 5U] = decompress_q(5U, coefficient6);
    int32_t
    coefficient7 =
      (byte5 & (int32_t)7)
      << (uint32_t)(int32_t)2
      | FStar_Int32_shift_arithmetic_right(byte4, (uint32_t)(int32_t)6);
    re[8U * i1 + 6U] = decompress_q(5U, coefficient7);
    int32_t coefficient8 = FStar_Int32_shift_arithmetic_right(byte5, (uint32_t)(int32_t)3);
    re[8U * i1 + 7U] = decompress_q(5U, coefficient8);
  }
  return re;
}

int32_t *Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_message(uint8_t *serialized)
{
  int32_t *re = impl__KyberPolynomialRingElement__ZERO;
  uint32_t start = 0U;
  uint32_t finish = 32U;
  for (uint32_t i0 = start; i0 < finish; i0++)
  {
    uint32_t i1 = i0;
    uint8_t byte = serialized[i1];
    uint32_t start1 = 0U;
    uint32_t finish1 = 8U;
    for (uint32_t i = start1; i < finish1; i++)
    {
      uint32_t j = i;
      int32_t coefficient_compressed = (int32_t)((uint32_t)byte >> j & 1U);
      re[8U * i1 + j] = decompress_q(1U, coefficient_compressed);
    }
  }
  return re;
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_ring_element_u(
  uint32_t v_COMPRESSION_FACTOR,
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  switch (v_COMPRESSION_FACTOR)
  {
    case 10U:
      {
        return Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_10_(serialized);
      }
    case 11U:
      {
        return Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_11_(serialized);
      }
    default:
      {
        KRML_HOST_EPRINTF("KaRaMeL incomplete match at %s:%d\n", __FILE__, __LINE__);
        KRML_HOST_EXIT(253U);
      }
  }
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_ring_element_v(
  uint32_t v_COMPRESSION_FACTOR,
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  switch (v_COMPRESSION_FACTOR)
  {
    case 4U:
      {
        return Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_4_(serialized);
      }
    case 5U:
      {
        return Libcrux_Kem_Kyber_Serialize_deserialize_then_decompress_5_(serialized);
      }
    default:
      {
        KRML_HOST_EPRINTF("KaRaMeL incomplete match at %s:%d\n", __FILE__, __LINE__);
        KRML_HOST_EXIT(253U);
      }
  }
}

int32_t
*Libcrux_Kem_Kyber_Serialize_deserialize_to_uncompressed_ring_element(
  Rust_primitives_Arrays_t_nonempty_Slice__uint8_t serialized
)
{
  int32_t *re = impl__KyberPolynomialRingElement__ZERO;
  uint32_t start = 0U;
  uint32_t finish = serialized.len / 3U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    int32_t byte1 = (int32_t)serialized.buffer[i1 * 3U + 0U];
    int32_t byte2 = (int32_t)serialized.buffer[i1 * 3U + 1U];
    int32_t byte3 = (int32_t)serialized.buffer[i1 * 3U + 2U];
    re[2U * i1] = (byte2 & (int32_t)15) << (uint32_t)(int32_t)8 | (byte1 & (int32_t)255);
    re[2U * i1 + 1U] =
      byte3
      << (uint32_t)(int32_t)4
      | (FStar_Int32_shift_arithmetic_right(byte2, (uint32_t)(int32_t)4) & (int32_t)15);
  }
  return re;
}

uint8_t *Libcrux_Kem_Kyber_Serialize_serialize_uncompressed_ring_element(int32_t *re)
{
  uint8_t serialized[384U] = { 0U };
  uint32_t start = 0U;
  uint32_t finish = 256U / 2U;
  for (uint32_t i = start; i < finish; i++)
  {
    uint32_t i1 = i;
    uint16_t coefficient1 = to_unsigned_representative(re[i1 * 2U + 0U]);
    uint16_t coefficient2 = to_unsigned_representative(re[i1 * 2U + 1U]);
    uint32_t m = 8U;
    uint16_t pow2_bits0 = 256U;
    uint16_t pow2_bits_minus_one0 = 128U;
    uint16_t
    a2 = (((uint32_t)coefficient1 & 255U) & ((1U << m) - 1U)) - (uint32_t)pow2_bits_minus_one0;
    uint16_t mask = (uint32_t)a2 >> 15U;
    uint16_t a30 = (((uint32_t)coefficient1 & 255U) & ((1U << m) - 1U)) - (uint32_t)pow2_bits0;
    uint16_t b = (uint32_t)a30 + ((uint32_t)mask & (uint32_t)pow2_bits0);
    serialized[3U * i1] = (uint8_t)b;
    uint32_t m0 = 8U;
    uint16_t pow2_bits1 = 256U;
    uint16_t pow2_bits_minus_one1 = 128U;
    uint16_t
    a20 =
      (((uint32_t)coefficient1
      >> (uint32_t)(int32_t)8
      | ((uint32_t)coefficient2 & 15U) << (uint32_t)(int32_t)4)
      & ((1U << m0) - 1U))
      - (uint32_t)pow2_bits_minus_one1;
    uint16_t mask0 = (uint32_t)a20 >> 15U;
    uint16_t
    a31 =
      (((uint32_t)coefficient1
      >> (uint32_t)(int32_t)8
      | ((uint32_t)coefficient2 & 15U) << (uint32_t)(int32_t)4)
      & ((1U << m0) - 1U))
      - (uint32_t)pow2_bits1;
    uint16_t b0 = (uint32_t)a31 + ((uint32_t)mask0 & (uint32_t)pow2_bits1);
    serialized[3U * i1 + 1U] = (uint8_t)b0;
    uint32_t m1 = 8U;
    uint16_t pow2_bits = 256U;
    uint16_t pow2_bits_minus_one = 128U;
    uint16_t
    a21 =
      (((uint32_t)coefficient2 >> (uint32_t)(int32_t)4 & 255U) & ((1U << m1) - 1U))
      - (uint32_t)pow2_bits_minus_one;
    uint16_t mask1 = (uint32_t)a21 >> 15U;
    uint16_t
    a3 =
      (((uint32_t)coefficient2 >> (uint32_t)(int32_t)4 & 255U) & ((1U << m1) - 1U))
      - (uint32_t)pow2_bits;
    uint16_t b1 = (uint32_t)a3 + ((uint32_t)mask1 & (uint32_t)pow2_bits);
    serialized[3U * i1 + 2U] = (uint8_t)b1;
  }
  return serialized;
}

